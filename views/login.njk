{% extends "layout.njk" %}
{% block content %}
<div class="min-h-screen flex items-center justify-center bg-neutral py-12 px-4 sm:px-6 lg:px-8">
  <div class="max-w-md w-full space-y-8">
    <div>
      <div class="mx-auto h-16 w-auto flex justify-center mb-6">
        <img src="/Assets/ConnectEdLogo.png" alt="ConnectEd Logo" class="h-16 w-auto" />
      </div>
      <h2 class="mt-6 text-center text-3xl font-bold text-textPrimary">Welcome to ConnectEd</h2>
      <p class="mt-2 text-center text-textSecondary">Sign in to your account to continue</p>
    </div>
    <form action="/login" method="POST" class="mt-8 space-y-6 bg-white rounded-xl p-8 shadow-md border border-neutral/20" novalidate>
      <input type="hidden" name="_csrf" value="{{ csrfToken }}">
      
      <!-- Username Field -->
      <div class="space-y-1">
        <label for="username" class="block text-sm font-semibold text-textPrimary">Username</label>
        <input id="username" name="username" type="text" required
               class="w-full px-4 py-3 border border-neutral/30 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary transition-colors placeholder:text-textSecondary"
               placeholder="Enter your username" autocomplete="username" aria-describedby="username-error" />
        {% if flash and flash.errors and flash.errors.username %}
          <p id="username-error" class="mt-1 text-sm text-error">{{ flash.errors.username }}</p>
        {% endif %}
      </div>

      <!-- Password Field -->
      <div class="space-y-1">
        <label for="password" class="block text-sm font-semibold text-textPrimary">Password</label>
        <div class="relative">
          <input id="password" name="password" type="password" required
                 class="w-full pr-12 py-3 border border-neutral/30 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary transition-colors placeholder:text-textSecondary"
                 placeholder="Enter your password" autocomplete="current-password" aria-describedby="password-error" />
          <button type="button" id="toggle-password" class="absolute inset-y-0 right-0 pr-3 flex items-center text-textSecondary hover:text-textPrimary">
            <i class="fas fa-eye"></i>
          </button>
        </div>
        {% if flash and flash.errors and flash.errors.password %}
          <p id="password-error" class="mt-1 text-sm text-error">{{ flash.errors.password }}</p>
        {% endif %}
      </div>

      <!-- Remember Me -->
      <div class="flex items-center justify-between">
        <div class="flex items-center">
          <input id="remember_me" name="remember_me" type="checkbox" class="h-4 w-4 text-primary focus:ring-primary border-neutral/30 rounded" />
          <label for="remember_me" class="ml-2 block text-sm text-textPrimary">Remember me</label>
        </div>
        <div class="text-sm">
          <a href="#" class="font-semibold text-primary hover:text-blue-700">Forgot password?</a>
        </div>
      </div>

      <!-- Submit Button -->
      <div>
        <button type="submit" class="group relative w-full flex justify-center py-3 px-4 border border-transparent text-sm font-semibold rounded-lg shadow-lg bg-primary text-white hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed">
          <span class="absolute left-0 inset-y-0 flex items-center pl-3">
            <i class="fas fa-sign-in-alt group-hover:translate-x-1 transition-transform duration-300"></i>
          </span>
          Sign In
        </button>
      </div>

      <!-- Divider -->
      <div class="relative">
        <div class="absolute inset-0 flex items-center">
          <div class="w-full border-t border-neutral/30"></div>
        </div>
        <div class="relative flex justify-center text-sm">
          <span class="px-2 bg-white text-textSecondary">Don't have an account?</span>
        </div>
      </div>

      <!-- Register Link -->
      <div class="text-center">
        <a href="/register" class="font-semibold text-primary hover:text-blue-700 transition-colors">Create your account</a>
      </div>
    </form>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const togglePassword = document.getElementById('toggle-password');
  const passwordInput = document.getElementById('password');
  const icon = togglePassword.querySelector('i');

  if (togglePassword && passwordInput) {
    togglePassword.addEventListener('click', function() {
      const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
      passwordInput.setAttribute('type', type);
      
      icon.classList.toggle('fa-eye');
      icon.classList.toggle('fa-eye-slash');
    });
  }

  // Form validation enhancement
  const form = document.querySelector('form');
  form.addEventListener('submit', function(e) {
    const username = document.getElementById('username');
    const password = document.getElementById('password');
    let valid = true;

    // Remove previous styling
    username.classList.remove('border-error', 'focus:ring-error');
    password.classList.remove('border-error', 'focus:ring-error');

    if (!username.value.trim()) {
      username.classList.add('border-error', 'focus:ring-error');
      valid = false;
    }

    if (!password.value) {
      password.classList.add('border-error', 'focus:ring-error');
      valid = false;
    }

    if (!valid) {
      e.preventDefault();
      username.focus();
    }
  });
});
</script>
{% endblock %}
